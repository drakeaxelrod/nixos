# Zsh and shell configuration
{ config, pkgs, ... }:

{
  programs.zsh = {
    enable = true;
    autosuggestion.enable = true;
    syntaxHighlighting.enable = true;
    enableCompletion = true;

    history = {
      size = 50000;
      save = 50000;
      ignoreDups = true;
      ignoreAllDups = true;
      ignoreSpace = true;
      share = true;
    };

    shellAliases = {
      ll = "eza -la";
      ls = "eza";
      la = "eza -a";
      lt = "eza --tree";
      cat = "bat";
      vim = "nvim";

      # NixOS (config at ~/.config/nixos)
      nixcfg = "~/.config/nixos";
      rebuild = "sudo nixos-rebuild switch --flake $nixcfg#$(hostname)";
      update = "nix flake update $nixcfg";
      gc = "sudo nix-collect-garbage -d";

      # Git
      gs = "git status";
      gd = "git diff";
      gco = "git commit";
      gp = "git push";
      gl = "git log --oneline --graph --decorate -10";
      lg = "lazygit";

      # Safety
      rm = "rm -i";
      cp = "cp -i";
      mv = "mv -i";
    };

    initContent = ''
      # Keybindings
      bindkey -e  # Emacs keybindings
      bindkey '^[[A' history-search-backward
      bindkey '^[[B' history-search-forward
      bindkey '^[[H' beginning-of-line
      bindkey '^[[F' end-of-line
      bindkey '^[[3~' delete-char

      # Better completion
      zstyle ':completion:*' menu select
      zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'

      # Work directory shortcut
      hash -d work=/work
    '';

    oh-my-zsh = {
      enable = true;
      plugins = [
        "git"
        "sudo"
        "docker"
        "systemd"
        "command-not-found"
      ];
    };
  };

  # Zoxide - smart cd
  programs.zoxide = {
    enable = true;
    enableZshIntegration = true;
  };

  # FZF - fuzzy finder
  programs.fzf = {
    enable = true;
    enableZshIntegration = true;
    defaultOptions = [
      "--height 40%"
      "--layout=reverse"
      "--border"
    ];
  };

  # Direnv - automatic environment loading
  programs.direnv = {
    enable = true;
    enableZshIntegration = true;
    nix-direnv.enable = true;
  };

  # Starship prompt
  programs.starship = {
    enable = true;
    enableZshIntegration = true;
  };
}
